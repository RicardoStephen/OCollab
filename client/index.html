<html>
<head>
    <title>Collaborative Text Editor</title>
    <script type="text/javascript" src="codemirror/lib/codemirror.js"></script>
    <link type="stylesheet" href="codemirror/lib/codemirror.css" />
    <script type="text/javascript">

function req(type, path, params, success, error) {
    var xhr = new XMLHttpRequest();
    xhr.open(type, path, true);
    xhr.onload = function(e) {
        if (this.status == 200) {
            success.call(this, e);
        }
    };
    xhr.onerror = function(e) {
        error.call(this, e);
    };
    xhr.send(params);
}

window.addEventListener("load", function() {
    if (location.search.length < 2) { // Home page
        var b = document.createElement("button");
        b.innerHTML = "Create a document";
        var out = document.createElement("div");
        b.addEventListener("click", function() {
            req("GET", "/create", "",
                function(e) {
                    var id = this.responseText;
                    var newloc = "?" + id;
                    out.innerHTML += "<a href=\"" + newloc + "\">Document created</a>";
                    setTimeout(function() {
                        location.href = newloc;
                    }, 2000);
                },
                function(e) {
                    out.innerHTML += "<div style=\"color:red\">Failed to create a document.</div>";
                }
            );
        });
        document.body.appendChild(b);
        document.body.appendChild(document.createElement("br"));
        document.body.appendChild(out);
    }
    else {
        // Get document id
        var id = location.search.substring(1);
        // Get session id
        req("POST", "/session", "docid=" + id,
            function(e) {
                var sid = e.responseText;
                console.log(sid);
            },
            function(e) {
                
            }
        );
    }
});

    </script>
</head>
<body>
</body>
</html>
